<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catarse Home Studio - Sistema de Agendamento</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéµ</text></svg>">
    
    <!-- ==================== -->
    <!-- NOVAS TAGS PWA -->
    <!-- ==================== -->
    <meta name="theme-color" content="#ff5500">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Catarse Studio">
    <link rel="apple-touch-icon" href="assets/sua-logo-20-p-cento.png">
    <link rel="manifest" href="manifest.json">
    <!-- ==================== -->
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Status de Conex√£o -->
    <div id="connection-status" class="connection-status offline">
        <div class="status-dot"></div>
        <span id="status-text">Offline</span>
    </div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <img src="assets/sua-logo-20-p-cento.png" alt="Catarse Home Studio" class="logo-image">
                    <div class="logo-text">Catarse Home Studio</div>
                </div>
                
                <nav>
                    <div class="nav-container">
                        <!-- Menu Desktop -->
                        <div class="nav-desktop">
                            <a href="#" class="nav-link active" data-page="calendar">Calend√°rio</a>
                            <a href="#" class="nav-link" data-page="clients">Clientes</a>
                            <a href="#" class="nav-link" data-page="bookings">Agendamentos</a>
                            <a href="#" class="nav-link" data-page="reports">Relat√≥rios</a>
                            <a href="#" class="nav-link" data-page="audit">Log do Sistema</a>
                        </div>
                        
                        <!-- Menu Mobile -->
                        <div class="nav-mobile">
                            <button class="mobile-menu-btn">
                                ‚ò∞ Menu
                            </button>
                            <div class="mobile-menu-content">
                                <a href="#" class="nav-link active" data-page="calendar">Calend√°rio</a>
                                <a href="#" class="nav-link" data-page="clients">Clientes</a>
                                <a href="#" class="nav-link" data-page="bookings">Agendamentos</a>
                                <a href="#" class="nav-link" data-page="reports">Relat√≥rios</a>
                                <a href="#" class="nav-link" data-page="audit">Log do Sistema</a>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </header>
        
        <!-- P√°ginas do app -->
        <section id="calendar" class="page active">
            <div class="calendar-header">
                <h2 class="calendar-title" id="current-month">Mar√ßo 2023</h2>
                <div class="calendar-nav">
                    <button id="prev-month" class="btn btn-secondary">‚Üê Anterior</button>
                    <button id="next-month" class="btn btn-secondary">Pr√≥ximo ‚Üí</button>
                    <button id="manual-sync" class="btn btn-info">üîÑ Sincronizar</button>
                </div>
            </div>
            
            <div class="calendar" id="calendar-days">
                <!-- Os dias do calend√°rio ser√£o gerados via JavaScript -->
            </div>
            
            <div id="day-details" style="display: none;">
                <h3 id="selected-day">Agendamentos para 15 de Mar√ßo, 2023</h3>
                
                <div class="day-agendamentos" id="day-agendamentos">
                    <!-- Lista de agendamentos do dia ser√° gerada via JavaScript -->
                </div>
                
                <div class="time-slots" id="time-slots">
                    <!-- Os hor√°rios ser√£o gerados via JavaScript -->
                </div>
                <button id="new-booking" class="btn">Novo Agendamento</button>
            </div>
        </section>
        
        <!-- P√°gina de Clientes -->
        <section id="clients" class="page">
            <h2>Cadastro de Clientes</h2>
            
            <div id="client-alert" class="alert" style="display: none;"></div>
            
            <form id="client-form">
                <input type="hidden" id="client-id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="client-type">Tipo</label>
                        <select id="client-type" required>
                            <option value="cpf">CPF</option>
                            <option value="cnpj">CNPJ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="client-document">CPF ou CNPJ</label>
                        <input type="text" id="client-document" required>
                        <button type="button" id="validate-cpf" class="btn btn-secondary" style="margin-top: 5px; display: none;">Validar CPF</button>
                        <small id="document-error" style="color: var(--error-color); display: none;">N√∫mero inv√°lido</small>
                        <div id="validation-status" style="display: none;"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="client-fullname">Nome Completo</label>
                    <input type="text" id="client-fullname" required>
                </div>
                
                <div class="form-group">
                    <label for="client-name">Nome Art√≠stico</label>
                    <input type="text" id="client-name" required>
                </div>
                
                <div class="form-group">
                    <label for="client-phone">Telefone de Contato</label>
                    <input type="tel" id="client-phone" required>
                </div>

                <div class="form-group">
                    <label for="client-email">E-mail (opcional)</label>
                    <input type="email" id="client-email">
                </div>

                <!-- Campos de Endere√ßo -->
                <div class="form-group">
                    <label for="client-cep">CEP</label>
                    <div class="cep-search">
                        <div class="form-group">
                            <input type="text" id="client-cep" maxlength="9" placeholder="00000-000">
                        </div>
                        <button type="button" id="search-cep" class="btn btn-secondary">Buscar CEP</button>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="client-street">Rua</label>
                        <input type="text" id="client-street">
                    </div>
                    <div class="form-group">
                        <label for="client-number">N√∫mero</label>
                        <input type="text" id="client-number">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="client-neighborhood">Bairro</label>
                        <input type="text" id="client-neighborhood">
                    </div>
                    <div class="form-group">
                        <label for="client-complement">Complemento</label>
                        <input type="text" id="client-complement" placeholder="Apto, Bloco, etc.">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="client-city">Cidade</label>
                        <input type="text" id="client-city">
                    </div>
                    <div class="form-group">
                        <label for="client-state">Estado</label>
                        <input type="text" id="client-state" maxlength="2" placeholder="SP">
                    </div>
                </div>

                <div class="form-group">
                    <label for="client-notes">Observa√ß√µes</label>
                    <textarea id="client-notes" rows="3" placeholder="Informa√ß√µes adicionais sobre o cliente..."></textarea>
                </div>
                
                <button type="submit" class="btn" id="client-submit-btn">Cadastrar Cliente</button>
                <button type="button" class="btn btn-secondary" id="client-cancel-btn" style="display: none;">Cancelar Edi√ß√£o</button>
            </form>

            <!-- Estat√≠sticas de Clientes -->
            <div class="client-stats" id="client-stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-clients">0</div>
                    <div class="stat-label">Total de Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="active-clients">0</div>
                    <div class="stat-label">Clientes com Agendamentos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-hours">0h</div>
                    <div class="stat-label">Horas Totais</div>
                </div>
            </div>
            
            <!-- Controles de Ordena√ß√£o -->
            <div class="clients-controls">
                <select id="sort-clients">
                    <option value="name">Ordenar por Nome</option>
                    <option value="hours">Ordenar por Horas</option>
                    <option value="sessions">Ordenar por Sess√µes</option>
                    <option value="recent">Ordenar por Data</option>
                </select>
                <button class="btn btn-secondary" id="apply-client-sort">
                    Aplicar Ordena√ß√£o
                </button>
                <button class="btn" id="export-clients">
                    Exportar Clientes
                </button>
            </div>
            
            <div class="bookings-list" id="clients-list">
                <!-- Lista de clientes ser√° gerada via JavaScript -->
            </div>
        </section>
        
        <!-- P√°gina de Agendamentos -->
        <section id="bookings" class="page">
            <h2>Agendamentos</h2>
            
            <div class="bookings-list" id="bookings-list">
                <!-- Lista de agendamentos ser√° gerada via JavaScript -->
            </div>
        </section>
        
        <!-- P√°gina de Relat√≥rios -->
        <section id="reports" class="page">
            <h2>Relat√≥rio de Horas por Cliente</h2>
            
            <div class="report-controls">
                <div class="form-group">
                    <label for="report-start-date">Data Inicial:</label>
                    <input type="date" id="report-start-date">
                </div>
                <div class="form-group">
                    <label for="report-end-date">Data Final:</label>
                    <input type="date" id="report-end-date">
                </div>
                <button id="generate-report" class="btn">Gerar Relat√≥rio</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Cliente ‚ñ≤</th>
                            <th data-sort="hours">Horas Utilizadas ‚ñ≤</th>
                            <th data-sort="sessions">N¬∫ de Sess√µes ‚ñ≤</th>
                            <th>Contato</th>
                        </tr>
                    </thead>
                    <tbody id="report-body">
                        <!-- Dados do relat√≥rio ser√£o gerados via JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- P√°gina: Log do Sistema -->
        <section id="audit" class="page">
            <h2>Log do Sistema - Hist√≥rico de Altera√ß√µes</h2>
            
            <div class="alert alert-info">
                <strong>Auditoria Completa:</strong> Todas as a√ß√µes importantes do sistema s√£o registradas aqui.
            </div>

            <!-- Filtros do Log -->
            <div class="log-filters">
                <div class="form-group">
                    <label for="log-entity">Filtrar por Entidade:</label>
                    <select id="log-entity">
                        <option value="all">Todas as Entidades</option>
                        <option value="client">Clientes</option>
                        <option value="booking">Agendamentos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="log-action">Filtrar por A√ß√£o:</label>
                    <select id="log-action">
                        <option value="all">Todas as A√ß√µes</option>
                        <option value="create">Cria√ß√µes</option>
                        <option value="update">Atualiza√ß√µes</option>
                        <option value="delete">Exclus√µes</option>
                        <option value="activity">Atividades</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="log-date">Data:</label>
                    <input type="date" id="log-date">
                </div>
                <button class="btn btn-secondary" id="apply-log-filters">
                    Aplicar Filtros
                </button>
                <button class="btn btn-info" id="clear-log-filters">
                    Limpar Filtros
                </button>
                <button class="btn btn-error" id="clear-all-logs">
                    Limpar Todo Log
                </button>
            </div>

            <!-- Estat√≠sticas do Log -->
            <div class="client-stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-logs">0</div>
                    <div class="stat-label">Total de Registros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="today-logs">0</div>
                    <div class="stat-label">Registros Hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="client-logs">0</div>
                    <div class="stat-label">A√ß√µes em Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="booking-logs">0</div>
                    <div class="stat-label">A√ß√µes em Agendamentos</div>
                </div>
            </div>
            
            <div class="bookings-list" id="audit-log-list">
                <!-- Lista de logs ser√° gerada via JavaScript -->
            </div>
        </section>
    </div>
    
    <!-- Modais -->
    <div id="booking-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Novo Agendamento</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <form id="booking-form">
                <input type="hidden" id="booking-id">
                <input type="hidden" id="booking-date">
                
                <div class="form-group">
                    <label for="booking-client">Cliente</label>
                    <select id="booking-client" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="booking-start">Hor√°rio de In√≠cio</label>
                    <select id="booking-start" required>
                        <option value="">Selecione o hor√°rio de in√≠cio</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="booking-duration">Dura√ß√£o</label>
                    <select id="booking-duration" required>
                        <option value="1">1 hora</option>
                        <option value="2">2 horas</option>
                        <option value="3">3 horas</option>
                        <option value="4">4 horas</option>
                        <option value="5">5 horas</option>
                        <option value="6">6 horas</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="booking-notes">Descri√ß√£o das Atividades Planejadas</label>
                    <textarea id="booking-notes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn" id="booking-submit-btn">Confirmar Agendamento</button>
                <button type="button" class="btn btn-secondary" id="booking-cancel-btn" style="display: none;">Cancelar Edi√ß√£o</button>
            </form>
        </div>
    </div>
    
    <div id="booking-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detalhes do Agendamento</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div id="booking-details-content">
                <!-- Conte√∫do dos detalhes ser√° gerado via JavaScript -->
            </div>
            
            <div class="booking-actions" style="margin-top: 20px;">
                <button class="btn btn-warning" id="edit-booking-btn">Editar Agendamento</button>
                <button class="btn btn-error" id="delete-booking-btn">Excluir Agendamento</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modular -->
    <script src="js/utils.js"></script>
    <script src="js/firebase-sync.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/clients.js"></script>
    <script src="js/bookings.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/audit-log.js"></script>
    <script src="js/app.js"></script>

    <!-- NOVO MODAL: Alerta de Clientes Duplicados -->
    <div id="duplicate-alert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="duplicate-alert-message">Clientes Similares Encontrados</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Aten√ß√£o!</strong> Encontramos clientes com dados similares. 
                    Verifique se n√£o √© a mesma pessoa antes de continuar.
                </div>
                
                <div class="duplicate-clients-list" id="duplicate-clients-list">
                    <!-- Lista de clientes similares ser√° preenchida via JavaScript -->
                </div>
                
                <div class="duplicate-actions" style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn btn-warning" id="use-existing-client-btn">
                        üö´ Usar Cliente Existente (Cancelar Cadastro)
                    </button>
                    <button class="btn btn-info" id="edit-existing-client-btn">
                        ‚úèÔ∏è Editar Cliente Existente
                    </button>
                    <button class="btn btn-success" id="continue-new-client-btn">
                        ‚úÖ Continuar com Novo Cadastro
                    </button>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: var(--secondary-color); border-radius: 4px;">
                    <small style="color: #aaa;">
                        <strong>Dica:</strong> 
                        <br>‚Ä¢ <strong>Usar Existente</strong> - Cancela este cadastro e usa o cliente j√° cadastrado
                        <br>‚Ä¢ <strong>Editar Existente</strong> - Abre o cliente similar para edi√ß√£o  
                        <br>‚Ä¢ <strong>Continuar</strong> - Prossegue com este cadastro (cliente diferente)
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== -->
    <!-- NOVO: REGISTRO SERVICE WORKER -->
    <!-- ==================== -->
    <script>
        // Registra o Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ Service Worker registrado com sucesso:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('‚ùå Service Worker falhou:', error);
                    });
            });
        }

        // Detecta se √© PWA (app instalado)
        function isRunningAsPWA() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        // Mostra instru√ß√µes de instala√ß√£o se n√£o for PWA
        if (!isRunningAsPWA() && 'serviceWorker' in navigator) {
            console.log('üì± App pode ser instalado como PWA');
        }
    </script>

</body>
</html>
